<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NH Seacoast Home Affordability Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            background: #e5e7eb;
            outline: none;
            border-radius: 8px;
            height: 8px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #4f46e5;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <div class="flex items-center gap-3 mb-6">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <h1 class="text-3xl font-bold text-gray-800">NH Seacoast Home Affordability Calculator</h1>
            </div>

            <!-- Inputs -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Combined Annual Income</label>
                    <input type="number" id="income" value="120000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Current Home Value</label>
                    <input type="number" id="currentHomeValue" value="450000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Home Equity</label>
                    <input type="number" id="equity" value="200000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Cash Savings</label>
                    <input type="number" id="savings" value="40000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Seller Commission %</label>
                    <input type="number" id="commission" value="6" min="0" max="10" step="0.5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Appraisal Gap Reserve %</label>
                    <input type="number" id="appraisalGap" value="3" min="0" max="10" step="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Down Payment %</label>
                    <input type="number" id="downPayment" value="20" min="5" max="50" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Annual Property Tax</label>
                    <input type="number" id="propertyTax" value="12000" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Annual Insurance</label>
                    <input type="number" id="insurance" value="1200" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                </div>
                <div class="lg:col-span-3">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Max Back-End DTI %</label>
                    <input type="range" id="dtiRatio" value="43" min="28" max="50" step="1" class="w-full">
                    <div class="flex justify-between text-xs text-gray-600 mt-1">
                        <span>28%</span>
                        <span class="font-bold text-indigo-600" id="dtiDisplay">43%</span>
                        <span>50%</span>
                    </div>
                </div>
            </div>

            <!-- Cash Summary -->
            <div id="cashSummary" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"></div>

            <!-- DTI Info -->
            <div id="dtiInfo" class="border-2 rounded-lg p-4 mb-6"></div>

            <!-- Results Table -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl p-6 mb-8">
                <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                    Affordability Scenarios by Interest Rate
                </h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm" id="resultsTable">
                        <thead>
                            <tr class="border-b border-white/20">
                                <th class="text-left py-3 px-2">Listed Rate</th>
                                <th class="text-left py-3 px-2">Your Rate</th>
                                <th class="text-left py-3 px-2">Points</th>
                                <th class="text-right py-3 px-2">Max Home Price</th>
                                <th class="text-right py-3 px-2">Loan Amount</th>
                                <th class="text-right py-3 px-2">Monthly P&I</th>
                                <th class="text-right py-3 px-2">Total Monthly</th>
                                <th class="text-right py-3 px-2">Cash Needed</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody"></tbody>
                    </table>
                </div>
                <div id="tableFooter" class="mt-3 text-xs opacity-90"></div>
            </div>

            <!-- School Districts -->
            <div class="bg-gray-50 rounded-xl p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    School District Comparison
                </h2>
                <div id="schoolDistricts" class="grid md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Cost Breakdown -->
            <div class="text-sm text-gray-600 bg-blue-50 rounded-lg p-4">
                <p class="font-semibold text-gray-800 mb-2">💡 Detailed Cost Breakdown (6.25% Rate Scenario):</p>
                <div id="assumptions"></div>
            </div>
        </div>
    </div>

    <script>
        const interestRates = [5.75, 6.0, 6.25, 6.5, 6.75];
        const schoolDistricts = [
            { name: 'Oyster River (Durham)', medianPrice: 695000 },
            { name: 'Exeter', medianPrice: 650000 },
            { name: 'Portsmouth', medianPrice: 750000 },
            { name: 'Newmarket', medianPrice: 550000 }
        ];


        function formatCurrency(num) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(num);
        }

        function calculateMonthlyPayment(principal, rate, years = 30) {
            const monthlyRate = rate / 100 / 12;
            const numPayments = years * 12;
            return principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / 
                   (Math.pow(1 + monthlyRate, numPayments) - 1);
        }

        function calculateAffordability(rate, inputs) {
            const sellingTransferTax = inputs.currentHomeValue * 0.015;
            const sellingCommission = inputs.currentHomeValue * (inputs.commission / 100);
            const sellingFees = inputs.currentHomeValue * 0.005;
            const totalSellingCosts = sellingTransferTax + sellingCommission + sellingFees;
            
            const netEquityAfterSale = inputs.equity - totalSellingCosts;
            const totalCashAvailable = netEquityAfterSale + inputs.savings;
            
            const monthlyIncome = inputs.income / 12;
            const maxMonthlyPayment = monthlyIncome * (inputs.dtiRatio / 100);
            const monthlyTaxInsurance = (inputs.propertyTax + inputs.insurance) / 12;
            const availableForPI = maxMonthlyPayment - monthlyTaxInsurance;
            
            let bestResult = null;
            
            for (let points = 0; points <= 3; points += 0.5) {
                const adjustedRate = rate - (points * 0.25);
                let low = 100000;
                let high = 3000000;
                let maxHomePrice = 0;
                
                while (high - low > 100) {
                    const mid = (low + high) / 2;
                    const testDownPayment = mid * (inputs.downPayment / 100);
                    const testLoanAmount = mid - testDownPayment;
                    const testPointsCost = testLoanAmount * (points / 100);
                    
                    const buyingTransferTax = mid * 0.015;
                    const buyingClosingFees = mid * 0.02;
                    const buyingAppraisalGap = mid * (inputs.appraisalGap / 100);
                    const totalBuyingCosts = buyingTransferTax + buyingClosingFees + buyingAppraisalGap;
                    
                    const testCashNeeded = testDownPayment + testPointsCost + totalBuyingCosts;
                    const testPayment = calculateMonthlyPayment(testLoanAmount, adjustedRate);
                    
                    if (testPayment <= availableForPI && testCashNeeded <= totalCashAvailable) {
                        maxHomePrice = mid;
                        low = mid;
                    } else {
                        high = mid;
                    }
                }
                
                if (!bestResult || maxHomePrice > bestResult.maxHomePrice) {
                    const actualDownPayment = maxHomePrice * (inputs.downPayment / 100);
                    const loanAmount = maxHomePrice - actualDownPayment;
                    const pointsCost = loanAmount * (points / 100);
                    
                    const buyingTransferTax = maxHomePrice * 0.015;
                    const buyingClosingFees = maxHomePrice * 0.02;
                    const buyingAppraisalGap = maxHomePrice * (inputs.appraisalGap / 100);
                    const totalBuyingCosts = buyingTransferTax + buyingClosingFees + buyingAppraisalGap;
                    
                    const cashNeeded = actualDownPayment + pointsCost + totalBuyingCosts;
                    const monthlyPI = calculateMonthlyPayment(loanAmount, adjustedRate);
                    const totalMonthly = monthlyPI + monthlyTaxInsurance;
                    
                    bestResult = {
                        maxHomePrice,
                        loanAmount,
                        monthlyPI,
                        totalMonthly,
                        cashNeeded,
                        adjustedRate,
                        optimalPoints: points,
                        netEquityAfterSale,
                        totalSellingCosts
                    };
                }
            }
            
            return bestResult;
        }

        function getInputs() {
            return {
                income: parseFloat(document.getElementById('income').value),
                currentHomeValue: parseFloat(document.getElementById('currentHomeValue').value),
                equity: parseFloat(document.getElementById('equity').value),
                savings: parseFloat(document.getElementById('savings').value),
                commission: parseFloat(document.getElementById('commission').value),
                appraisalGap: parseFloat(document.getElementById('appraisalGap').value),
                downPayment: parseFloat(document.getElementById('downPayment').value),
                propertyTax: parseFloat(document.getElementById('propertyTax').value),
                insurance: parseFloat(document.getElementById('insurance').value),
                dtiRatio: parseFloat(document.getElementById('dtiRatio').value)
            };
        }

        function updateCalculations() {
            const inputs = getInputs();
            const scenarios = interestRates.map(rate => ({
                rate,
                ...calculateAffordability(rate, inputs)
            }));

            // Update DTI display
            document.getElementById('dtiDisplay').textContent = inputs.dtiRatio + '%';

            // Update cash summary
            const firstScenario = scenarios[0];
            document.getElementById('cashSummary').innerHTML = `
                <h3 class="font-bold text-gray-800 mb-2">💰 Cash Position Summary</h3>
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div>
                        <div class="text-gray-600">Selling Costs (Current Home)</div>
                        <div class="font-bold text-red-600">${formatCurrency(firstScenario.totalSellingCosts)}</div>
                        <div class="text-xs text-gray-500">Transfer tax (1.5%), commission (${inputs.commission}%), fees (0.5%)</div>
                    </div>
                    <div>
                        <div class="text-gray-600">Net Equity After Sale</div>
                        <div class="font-bold text-green-600">${formatCurrency(firstScenario.netEquityAfterSale)}</div>
                        <div class="text-xs text-gray-500">Equity (${formatCurrency(inputs.equity)}) - selling costs</div>
                    </div>
                    <div>
                        <div class="text-gray-600">Total Cash Available</div>
                        <div class="font-bold text-indigo-600 text-lg">${formatCurrency(firstScenario.netEquityAfterSale + inputs.savings)}</div>
                        <div class="text-xs text-gray-500">Net equity + savings (${formatCurrency(inputs.savings)})</div>
                    </div>
                </div>
            `;

            // Update DTI info
            const dtiClass = inputs.dtiRatio <= 36 ? 'bg-green-50 border-green-300' : 
                           inputs.dtiRatio <= 43 ? 'bg-yellow-50 border-yellow-300' : 
                           'bg-orange-50 border-orange-300';
            const dtiEmoji = inputs.dtiRatio <= 36 ? '✅' : inputs.dtiRatio <= 43 ? '⚠️' : '🔥';
            const dtiLabel = inputs.dtiRatio <= 36 ? 'Conservative (Ideal)' : 
                           inputs.dtiRatio <= 43 ? 'Standard (Qualified Mortgage Limit)' : 
                           'Aggressive (Requires Strong Profile)';
            const dtiDesc = inputs.dtiRatio <= 36 ? 'Excellent financial cushion. Lenders love this and you\'ll get best rates.' :
                          inputs.dtiRatio <= 43 ? 'Standard maximum for qualified mortgages. Most lenders comfortable here with good credit.' :
                          'Above conventional limits. May require exceptional credit (740+), larger down payment (25%+).';
            
            document.getElementById('dtiInfo').className = `border-2 rounded-lg p-4 mb-6 ${dtiClass}`;
            document.getElementById('dtiInfo').innerHTML = `
                <div class="flex items-start gap-2">
                    <div class="text-2xl">${dtiEmoji}</div>
                    <div>
                        <div class="font-bold text-gray-800 mb-1">DTI: ${inputs.dtiRatio}% - ${dtiLabel}</div>
                        <div class="text-sm text-gray-700">${dtiDesc}</div>
                        <div class="text-xs text-gray-600 mt-2">
                            Max monthly housing: <span class="font-semibold">${formatCurrency(inputs.income/12 * inputs.dtiRatio/100)}</span> 
                            (${inputs.dtiRatio}% of ${formatCurrency(inputs.income/12)} monthly income)
                        </div>
                    </div>
                </div>
            `;

            // Update results table
            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = scenarios.map(s => `
                <tr class="border-b border-white/10 hover:bg-white/10 transition-colors">
                    <td class="py-3 px-2 font-semibold">${s.rate}%</td>
                    <td class="py-3 px-2 font-bold text-green-200">${s.adjustedRate.toFixed(3)}%</td>
                    <td class="py-3 px-2 text-yellow-200">${s.optimalPoints}</td>
                    <td class="text-right py-3 px-2 font-bold">${formatCurrency(s.maxHomePrice)}</td>
                    <td class="text-right py-3 px-2">${formatCurrency(s.loanAmount)}</td>
                    <td class="text-right py-3 px-2">${formatCurrency(s.monthlyPI)}</td>
                    <td class="text-right py-3 px-2 font-semibold">${formatCurrency(s.totalMonthly)}</td>
                    <td class="text-right py-3 px-2">${formatCurrency(s.cashNeeded)}</td>
                </tr>
            `).join('');

            document.getElementById('tableFooter').textContent = 
                `All scenarios calculated to use exactly ${inputs.dtiRatio}% of your $${(inputs.income/1000).toFixed(0)}k income (${formatCurrency(inputs.income/12 * inputs.dtiRatio/100)}/month max) • Points are automatically optimized (0-3 points) to maximize home price at each rate`;

            // Update school districts and cost breakdown for 6.25% scenario
            const middleScenario = scenarios[2]; // 6.25% rate scenario
            document.getElementById('schoolDistricts').innerHTML = schoolDistricts.map(district => {
                const canAfford = middleScenario.maxHomePrice >= district.medianPrice;
                const priceRatio = (district.medianPrice / middleScenario.maxHomePrice) * 100;
                const borderClass = canAfford ? 'border-green-300 bg-green-50' : 
                                  priceRatio <= 110 ? 'border-yellow-300 bg-yellow-50' : 
                                  'border-red-300 bg-red-50';
                const badgeClass = canAfford ? 'bg-green-200 text-green-800' : 
                                  priceRatio <= 110 ? 'bg-yellow-200 text-yellow-800' : 
                                  'bg-red-200 text-red-800';
                const badgeText = canAfford ? '✓ Comfortable' : priceRatio <= 110 ? '⚠ Stretch' : '✗ Over Budget';
                
                return `
                    <div class="border-2 rounded-lg p-4 ${borderClass}">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="font-bold text-gray-800">${district.name}</h3>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${badgeClass}">${badgeText}</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-1">
                            Median Price: <span class="font-semibold text-gray-800">${formatCurrency(district.medianPrice)}</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            At 6.25% rate (${inputs.dtiRatio}% DTI), you can afford up to ${formatCurrency(middleScenario.maxHomePrice)}
                        </div>
                    </div>
                `;
            }).join('');
            const sellingCosts = {
                transferTax: inputs.currentHomeValue * 0.015,
                commission: inputs.currentHomeValue * (inputs.commission / 100),
                fees: inputs.currentHomeValue * 0.005
            };
            const buyingCosts = {
                transferTax: middleScenario.maxHomePrice * 0.015,
                closingFees: middleScenario.maxHomePrice * 0.02,
                appraisalGap: middleScenario.maxHomePrice * (inputs.appraisalGap / 100),
                downPayment: middleScenario.maxHomePrice * (inputs.downPayment / 100),
                pointsCost: middleScenario.loanAmount * (middleScenario.optimalPoints / 100)
            };
            
            document.getElementById('assumptions').innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">💰 Current Home Sale (Net Cash)</h4>
                        <div class="text-xs space-y-1">
                            <div class="flex justify-between"><span>Current equity:</span><span class="font-semibold text-green-600">+${formatCurrency(inputs.equity)}</span></div>
                            <div class="flex justify-between"><span>Transfer tax (1.5%):</span><span class="text-red-600">-${formatCurrency(sellingCosts.transferTax)}</span></div>
                            <div class="flex justify-between"><span>Commission (${inputs.commission}%):</span><span class="text-red-600">-${formatCurrency(sellingCosts.commission)}</span></div>
                            <div class="flex justify-between"><span>Other fees (0.5%):</span><span class="text-red-600">-${formatCurrency(sellingCosts.fees)}</span></div>
                            <div class="flex justify-between border-t pt-1"><span class="font-semibold">Net from sale:</span><span class="font-bold text-green-600">+${formatCurrency(middleScenario.netEquityAfterSale)}</span></div>
                            <div class="flex justify-between"><span>Cash savings:</span><span class="font-semibold text-green-600">+${formatCurrency(inputs.savings)}</span></div>
                            <div class="flex justify-between border-t pt-1 font-bold"><span>Total available:</span><span class="text-indigo-600">${formatCurrency(middleScenario.netEquityAfterSale + inputs.savings)}</span></div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 mb-2">🏠 New Home Purchase (6.25% Rate)</h4>
                        <div class="text-xs space-y-1">
                            <div class="flex justify-between"><span>Home price:</span><span class="font-bold text-indigo-600">${formatCurrency(middleScenario.maxHomePrice)}</span></div>
                            <div class="flex justify-between"><span>Down payment (${inputs.downPayment}%):</span><span class="text-red-600">-${formatCurrency(buyingCosts.downPayment)}</span></div>
                            <div class="flex justify-between"><span>Transfer tax (1.5%):</span><span class="text-red-600">-${formatCurrency(buyingCosts.transferTax)}</span></div>
                            <div class="flex justify-between"><span>Closing fees (2%):</span><span class="text-red-600">-${formatCurrency(buyingCosts.closingFees)}</span></div>
                            <div class="flex justify-between"><span>Appraisal gap (${inputs.appraisalGap}%):</span><span class="text-red-600">-${formatCurrency(buyingCosts.appraisalGap)}</span></div>
                            <div class="flex justify-between"><span>Points (${middleScenario.optimalPoints}):</span><span class="text-red-600">-${formatCurrency(buyingCosts.pointsCost)}</span></div>
                            <div class="flex justify-between border-t pt-1 font-bold"><span>Total cash needed:</span><span class="text-red-600">${formatCurrency(middleScenario.cashNeeded)}</span></div>
                            <div class="flex justify-between"><span class="font-semibold text-gray-600">Monthly payment:</span><span class="font-bold text-indigo-600">${formatCurrency(middleScenario.totalMonthly)}</span></div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Add event listeners
        ['income', 'currentHomeValue', 'equity', 'savings', 'commission', 'appraisalGap', 
         'downPayment', 'propertyTax', 'insurance', 'dtiRatio'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateCalculations);
        });

        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>